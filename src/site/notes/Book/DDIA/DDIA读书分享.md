---
{"dg-publish":true,"permalink":"/book/ddia/ddia/"}
---


# 为什么要读DDIA

- DDIA的中文翻译叫 *<<设计数据密集型应用>>*，我们后端开发大部分时间都是在开发数据密集型应用，这部分内容跟工作关联度非常高
- 算是比较权威的书，比网上零散的文章更加系统
- 对redis、zk这些分布式中间件的通用原理能有更深层次的理解，从更全局的视角看待问题
- 个人看了之后感觉深度、广度都不错，讲原理不讲细节

## 缺点

讲原理不讲细节，想更深入理解的话，这本书没有给出答案，不过个人感觉对我们业务开发来说足够了，对中间件开发来说可能只能算入门

# 分享内容

第一章讲的是单机数据库系统的设计，印象比较深的是一个SSTable的实现思路，因为跟我们工作内容相关性没那么多，所以这部分不分享了，主要分享内容以后半部分的分布式一致性为主

## CAP

网上大部分的对CAP定理的说法是:

> CAP原则又称CAP定理，**指的是在一个分布式系统中，一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance）**。 CAP 原则指的是，这三个要素最多只能同时实现两点，不可能三者兼顾

这个解释方式反正我第一次接触的时候是没看懂的，只是说了结论，没说原因，并且感觉网上大部分文章其实都没讲明白，这本书里感觉定义就非常清楚，并且明确的把CAP说成了 *没有帮助*:

> CAP 有时以这种面目出现：一致性，可用性和分区容错性：三者只能择其二。不幸的是这种说法很有误导性，因为网络分区是一种故障类型，所以它并不是一个选项：不管你喜不喜欢它都会发生。
> 
> 在网络正常工作的时候，系统可以提供一致性（线性一致性）和整体可用性。发生网络故障时，你必须在线性一致性和整体可用性之间做出选择。因此，CAP 更好的表述成：在分区时要么选择一致，要么选择可用。一个更可靠的网络需要减少这个选择，但是在某些时候选择是不可避免的。
> 
> 在 CAP 的讨论中，术语可用性有几个相互矛盾的定义，形式化作为一个定理并不符合其通常的含义。许多所谓的 “高可用”（容错）系统实际上不符合 CAP 对可用性的特殊定义。总而言之，围绕着 CAP 有很多误解和困惑，并不能帮助我们更好地理解系统，所以最好避免使用 CAP

说白了就是系统发生分区，并不是一个选项，它是一个分布式系统长时间运行后，必然会发生的一个 *故障*，在这种故障发生后，CP跟AP只能选择一种

### 为什么CP跟AP不可兼得

#### 从单机系统开始演进

假如系统目前只有一台单机数据库A:

<style>
.container {font-family: sans-serif; text-align: center;}
.button-wrapper button {z-index: 1;height: 40px; width: 100px; margin: 10px;padding: 5px;}
.excalidraw .App-menu_top .buttonList { display: flex;}
.excalidraw-wrapper { height: 800px; margin: 50px; position: relative;}
:root[dir="ltr"] .excalidraw .layer-ui__wrapper .zen-mode-transition.App-menu_bottom--transition-left {transform: none;}
</style><script src="https://unpkg.com/react@17/umd/react.production.min.js"></script><script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script><script type="text/javascript" src="https://unpkg.com/@excalidraw/excalidraw@0.12.0/dist/excalidraw.production.min.js"></script><div id="DDIA分享-01excalidraw.md1"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://excalidraw.com","elements":[{"id":"vUx56GAEK-P9OzWnAnCsI","type":"ellipse","x":-73.09375,"y":-225.79296875,"width":80,"height":78,"angle":0,"strokeColor":"#000000","backgroundColor":"#fab005","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"sharp","seed":1674145458,"version":121,"versionNonce":1983223474,"isDeleted":false,"boundElements":[{"type":"text","id":"M5xZlP4j"}],"updated":1670943270415,"link":null,"locked":false},{"id":"M5xZlP4j","type":"text","x":-40.59375,"y":-199.29296875,"width":15,"height":25,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"sharp","seed":1364853490,"version":46,"versionNonce":1654252910,"isDeleted":false,"boundElements":null,"updated":1670943270415,"link":null,"locked":false,"text":"A","rawText":"A","fontSize":20,"fontFamily":1,"textAlign":"center","verticalAlign":"middle","baseline":18,"containerId":"vUx56GAEK-P9OzWnAnCsI","originalText":"A"}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#000000","currentItemBackgroundColor":"#fab005","currentItemFillStyle":"hachure","currentItemStrokeWidth":1,"currentItemStrokeStyle":"solid","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":1,"currentItemFontSize":20,"currentItemTextAlign":"left","currentItemStrokeSharpness":"sharp","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemLinearStrokeSharpness":"round","gridSize":null,"colorPalette":{}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("DDIA分享-01excalidraw.md1");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

只要服务不发生故障，那可以理解为它是一直可用的，但是服务总会有故障的那一天，因为只有单机，所以一旦故障了就会造成损失，为了防止A故障服务不可用，就必然需要引入多台机器，组成集群，比如加了一台B

#### 增加机器(节点)数量

假如加入了一台机器B，作为备份:

<div id="DDIA分享-02excalidraw.md2"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://excalidraw.com","elements":[{"type":"ellipse","version":123,"versionNonce":898359022,"isDeleted":false,"id":"hgtB4-9-lvKOE-VgGPeVs","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-143,"y":-131.609375,"strokeColor":"#000000","backgroundColor":"#fab005","width":80,"height":78,"seed":1926963822,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"0qejQ8RJ","type":"text"}],"updated":1670943556747,"link":null,"locked":false},{"type":"text","version":47,"versionNonce":929285426,"isDeleted":false,"id":"0qejQ8RJ","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-110.5,"y":-105.109375,"strokeColor":"#000000","backgroundColor":"transparent","width":15,"height":25,"seed":363922290,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1670943556747,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"A","rawText":"A","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"hgtB4-9-lvKOE-VgGPeVs","originalText":"A"},{"type":"ellipse","version":232,"versionNonce":1360461550,"isDeleted":false,"id":"teNLPZQ0A5JzD2C5qCAdU","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":3.279296875,"y":-133.10546875,"strokeColor":"#000000","backgroundColor":"#82c91e","width":80,"height":78,"seed":852349230,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"8bpU9W1m","type":"text"}],"updated":1670943775950,"link":null,"locked":false},{"type":"text","version":156,"versionNonce":789524210,"isDeleted":false,"id":"8bpU9W1m","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":34.779296875,"y":-106.60546875,"strokeColor":"#000000","backgroundColor":"transparent","width":17,"height":25,"seed":110469298,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1670943775950,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"B","rawText":"B","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"teNLPZQ0A5JzD2C5qCAdU","originalText":"B"}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#000000","currentItemBackgroundColor":"#82c91e","currentItemFillStyle":"hachure","currentItemStrokeWidth":1,"currentItemStrokeStyle":"solid","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":1,"currentItemFontSize":20,"currentItemTextAlign":"left","currentItemStrokeSharpness":"sharp","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemLinearStrokeSharpness":"round","gridSize":null,"colorPalette":{}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("DDIA分享-02excalidraw.md2");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

这个时候第一个问题来了，两台数据库服务器，他们怎么交互?

想想Mysql，一主一备，那是否可以让B成为A的备份，从A那里同步数据，假如按这个思路，A就成了主库，B成了从库，书里对这种方式叫 **复制**，这种架构叫 **单主复制** :

<div id="DDIA分享-03excalidraw.md3"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://excalidraw.com","elements":[{"type":"ellipse","version":166,"versionNonce":814318898,"isDeleted":false,"id":"Lht3WEqRHTBjAadoPyhkd","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-111.3154296875,"y":-131.861328125,"strokeColor":"#000000","backgroundColor":"#fab005","width":80,"height":78,"seed":1539931186,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"B9btEa4D","type":"text"},{"id":"Uu-O2lLzhcJwUfgh_sLb4","type":"arrow"}],"updated":1670943797518,"link":null,"locked":false},{"type":"text","version":88,"versionNonce":446832366,"isDeleted":false,"id":"B9btEa4D","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-78.8154296875,"y":-105.361328125,"strokeColor":"#000000","backgroundColor":"transparent","width":15,"height":25,"seed":1019287534,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1670943797518,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"A","rawText":"A","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"Lht3WEqRHTBjAadoPyhkd","originalText":"A"},{"type":"ellipse","version":255,"versionNonce":913704946,"isDeleted":false,"id":"nIdXcCVbMsrRF25wGBstc","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":68.7529296875,"y":-131.255859375,"strokeColor":"#000000","backgroundColor":"#82c91e","width":80,"height":78,"seed":1030694386,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"rm0JameQ","type":"text"},{"id":"Uu-O2lLzhcJwUfgh_sLb4","type":"arrow"}],"updated":1670943808849,"link":null,"locked":false},{"type":"text","version":177,"versionNonce":432285742,"isDeleted":false,"id":"rm0JameQ","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":100.2529296875,"y":-104.755859375,"strokeColor":"#000000","backgroundColor":"transparent","width":17,"height":25,"seed":1895033390,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1670943808849,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"B","rawText":"B","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"nIdXcCVbMsrRF25wGBstc","originalText":"B"},{"id":"Uu-O2lLzhcJwUfgh_sLb4","type":"arrow","x":-24.946057801942423,"y":-92.71792791600382,"width":89.22120621316077,"height":0.22940759502593266,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"round","seed":1915642670,"version":197,"versionNonce":329970286,"isDeleted":false,"boundElements":null,"updated":1670943808849,"link":null,"locked":false,"points":[[0,0],[89.22120621316077,-0.22940759502593266]],"lastCommittedPoint":null,"startBinding":{"elementId":"Lht3WEqRHTBjAadoPyhkd","focus":0.006788289082259551,"gap":6.369603504498876},"endBinding":{"elementId":"nIdXcCVbMsrRF25wGBstc","focus":0.02066245171581273,"gap":4.483406020516547},"startArrowhead":null,"endArrowhead":"arrow"},{"id":"xCpfE4dR","type":"text","x":-9.94140625,"y":-132.99609375,"width":42,"height":22,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"sharp","seed":1095458994,"version":50,"versionNonce":1481262,"isDeleted":false,"boundElements":null,"updated":1670943810184,"link":null,"locked":false,"text":"复制","rawText":"复制","fontSize":20,"fontFamily":4,"textAlign":"left","verticalAlign":"top","baseline":18,"containerId":null,"originalText":"复制"}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#000000","currentItemBackgroundColor":"transparent","currentItemFillStyle":"hachure","currentItemStrokeWidth":1,"currentItemStrokeStyle":"solid","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":4,"currentItemFontSize":20,"currentItemTextAlign":"left","currentItemStrokeSharpness":"sharp","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemLinearStrokeSharpness":"round","gridSize":null,"colorPalette":{}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("DDIA分享-03excalidraw.md3");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

#### 发生分区

这个简单的例子里面，假如对A写入了某个数据之后，还没有同步给B时A挂了，那接下来只有两种方案
1. 让请求继续访问B读取数据，但是B里面有一些数据是在A挂了之后还没有及时同步的，也就是虽然B继续提供服务保证集群容错，满足了可用性，但是存在数据不一致
2. 整体拒绝服务，等A恢复后，把数据同步给了B，再提供服务，这样可以保证数据一致，但是系统无法高可用

### 是不是真的只能二选一

CAP里的C指的是 **线性一致性**，也就是说如果在系统发生分区的情况下，确实线性一致性跟高可用是只能二选一的，但是现实情况，大部分场景下我们都不需要线性一致性这种强一致性保证，所以经过一定的取舍，实际的系统实现上，往往看起来 **一致性(非线性一致性)** 跟高可用是可以兼得的，这个也是刚学概念的时候非常困惑的一点

## 复制 VS 分区

### 复制

前面提到了为了保证集群具备一定的容错能力，可以加机器，通过复制的方式，来达到高可用

也就是说复制，主要就是为了解决服务的容错能力

### 分区

复制解决了服务的高可用问题，但是并没有实际提高服务的存储能力(容量)，也就是说假如只有复制，那加机器只是让集群完全挂掉的可能性降低了，实际容量还是一样的

复制是每台机器都保留相同的副本，分区则是每台机器存储一部分数据，实际应用的架构是两种结合的，因为如果只有分区，则服务的容量可以随着机器数增加而增加，但是假如某台机器挂了，那部分数据就丢失了，所以大的架构上是先分区，小集群再做复制

<div id="DDIA分享-04excalidraw.md4"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://excalidraw.com","elements":[{"type":"rectangle","version":95,"versionNonce":1862441388,"isDeleted":false,"id":"es3Z0_Qs7U0wavlhOXbIe","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-193.265625,"y":-223.6171875,"strokeColor":"#000000","backgroundColor":"transparent","width":132.375,"height":242.8515625,"seed":1467284524,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825410,"link":null,"locked":false},{"type":"ellipse","version":89,"versionNonce":1937985684,"isDeleted":false,"id":"Kk2JhK59lJiVlE_Ez-9I3","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-163.26453993055554,"y":-196.54296875,"strokeColor":"#000000","backgroundColor":"#fab005","width":65,"height":64,"seed":749870380,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"type":"text","id":"zJ8bBYyS"},{"id":"GxCYX4pDZ7UzGKGmSygHY","type":"arrow"}],"updated":1671026827302,"link":null,"locked":false},{"type":"text","version":21,"versionNonce":1431995436,"isDeleted":false,"id":"zJ8bBYyS","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-138.26453993055554,"y":-177.04296875,"strokeColor":"#000000","backgroundColor":"transparent","width":15,"height":25,"seed":1384518188,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825410,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"A","rawText":"A","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"Kk2JhK59lJiVlE_Ez-9I3","originalText":"A"},{"type":"ellipse","version":132,"versionNonce":292822548,"isDeleted":false,"id":"CgWdqFOX4HBVo96_ztG6l","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-163.16796875,"y":-79.6484375,"strokeColor":"#000000","backgroundColor":"#fab005","width":65,"height":64,"seed":1752215980,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"TP6Fp1NI","type":"text"},{"id":"GxCYX4pDZ7UzGKGmSygHY","type":"arrow"}],"updated":1671026830417,"link":null,"locked":false},{"type":"text","version":64,"versionNonce":777068204,"isDeleted":false,"id":"TP6Fp1NI","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-141.16796875,"y":-60.1484375,"strokeColor":"#000000","backgroundColor":"transparent","width":21,"height":25,"seed":426610452,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"A'","rawText":"A'","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"CgWdqFOX4HBVo96_ztG6l","originalText":"A'"},{"type":"rectangle","version":188,"versionNonce":1909879316,"isDeleted":false,"id":"XP3bqnDezOGCXZO4IzT-E","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":68.6171875,"y":-219.75390625,"strokeColor":"#000000","backgroundColor":"transparent","width":132.375,"height":242.8515625,"seed":107623852,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825411,"link":null,"locked":false},{"type":"ellipse","version":220,"versionNonce":586103700,"isDeleted":false,"id":"AQbVVLASoPnLbelYF7TRU","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":98.548828125,"y":-192.6796875,"strokeColor":"#000000","backgroundColor":"#15aabf","width":65,"height":64,"seed":348015380,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"BLKTD0n4","type":"text"},{"id":"rJF4wal8ygYp5k9kqDc0b","type":"arrow"}],"updated":1671026833750,"link":null,"locked":false},{"type":"text","version":152,"versionNonce":1810304916,"isDeleted":false,"id":"BLKTD0n4","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":122.548828125,"y":-173.1796875,"strokeColor":"#000000","backgroundColor":"transparent","width":17,"height":25,"seed":1433313324,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"B","rawText":"B","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"AQbVVLASoPnLbelYF7TRU","originalText":"B"},{"type":"ellipse","version":266,"versionNonce":1646962964,"isDeleted":false,"id":"T-EpiNB72gvFA5jIUFEgk","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":98.83984375,"y":-75.78515625,"strokeColor":"#000000","backgroundColor":"#15aabf","width":65,"height":64,"seed":1986775188,"groupIds":[],"strokeSharpness":"sharp","boundElements":[{"id":"AJ9srLzc","type":"text"},{"id":"rJF4wal8ygYp5k9kqDc0b","type":"arrow"}],"updated":1671026837616,"link":null,"locked":false},{"type":"text","version":199,"versionNonce":1695022356,"isDeleted":false,"id":"AJ9srLzc","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":120.33984375,"y":-56.28515625,"strokeColor":"#000000","backgroundColor":"transparent","width":22,"height":25,"seed":1300347564,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"B'","rawText":"B'","baseline":18,"textAlign":"center","verticalAlign":"middle","containerId":"T-EpiNB72gvFA5jIUFEgk","originalText":"B'"},{"type":"line","version":65,"versionNonce":1297157676,"isDeleted":false,"id":"66p7d4uJvr5EYU662Az8y","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"angle":0,"x":-121.47352430555557,"y":-226.78602430555554,"strokeColor":"#000000","backgroundColor":"transparent","width":115.59765625,"height":129.03515625,"seed":78541996,"groupIds":[],"strokeSharpness":"round","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"startBinding":null,"endBinding":null,"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":null,"points":[[0,0],[115.59765625,-129.03515625]]},{"type":"line","version":100,"versionNonce":917453460,"isDeleted":false,"id":"DHzEmd5-hwVTXWaCoyaZ0","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"angle":0,"x":-4.625,"y":-355.89453125,"strokeColor":"#000000","backgroundColor":"transparent","width":131.20703125,"height":135.4609375,"seed":411125036,"groupIds":[],"strokeSharpness":"round","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"startBinding":null,"endBinding":null,"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":null,"points":[[0,0],[131.20703125,135.4609375]]},{"type":"text","version":151,"versionNonce":906899220,"isDeleted":false,"id":"8TqeEkTF","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-83.65500351758664,"y":-393.0413517761663,"strokeColor":"#000000","backgroundColor":"transparent","width":172,"height":24,"seed":253460,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026852171,"link":null,"locked":false,"fontSize":21.87223800505051,"fontFamily":4,"text":"举例: 按范围分区","rawText":"举例: 按范围分区","baseline":20,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"举例: 按范围分区"},{"id":"EFL8DMgk","type":"text","x":-161.6640625,"y":-309.802517361111,"width":81,"height":22,"angle":0,"strokeColor":"#2b8a3e","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"sharp","seed":670510740,"version":59,"versionNonce":462604308,"isDeleted":false,"boundElements":null,"updated":1671026825411,"link":null,"locked":false,"text":"(0 - 100)","rawText":"(0 - 100)","fontSize":20,"fontFamily":4,"textAlign":"left","verticalAlign":"top","baseline":18,"containerId":null,"originalText":"(0 - 100)"},{"type":"text","version":135,"versionNonce":837579564,"isDeleted":false,"id":"Q0V7KiPA","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"angle":0,"x":69.07291666666654,"y":-316.4661458333332,"strokeColor":"#2b8a3e","backgroundColor":"transparent","width":100,"height":22,"seed":746100244,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"fontSize":20,"fontFamily":4,"text":"(100 - 200)","rawText":"(100 - 200)","baseline":18,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"(100 - 200)"},{"id":"GxCYX4pDZ7UzGKGmSygHY","type":"arrow","x":-131.93034290397662,"y":-130.46061098177444,"width":0.4015942110518722,"height":45.50149765996176,"angle":0,"strokeColor":"#2b8a3e","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"round","seed":70247340,"version":114,"versionNonce":128492948,"isDeleted":false,"boundElements":null,"updated":1671026825411,"link":null,"locked":false,"points":[[0,0],[-0.4015942110518722,45.50149765996176]],"lastCommittedPoint":null,"startBinding":{"elementId":"Kk2JhK59lJiVlE_Ez-9I3","focus":0.026201973645716366,"gap":2.1017186239347723},"endBinding":{"elementId":"CgWdqFOX4HBVo96_ztG6l","focus":-0.06132909178899008,"gap":5.3467889700542415},"startArrowhead":null,"endArrowhead":"arrow"},{"type":"arrow","version":182,"versionNonce":550317484,"isDeleted":false,"id":"rJF4wal8ygYp5k9kqDc0b","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"angle":0,"x":130.63230541978544,"y":-124.500138599508,"strokeColor":"#2b8a3e","backgroundColor":"transparent","width":0.37977430555557135,"height":45.5013020833334,"seed":2035590676,"groupIds":[],"strokeSharpness":"round","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"startBinding":{"elementId":"AQbVVLASoPnLbelYF7TRU","focus":0.003524556027098195,"gap":4.181881492379816},"endBinding":{"elementId":"T-EpiNB72gvFA5jIUFEgk","focus":-0.04249769814576015,"gap":3.2299964102373764},"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"arrow","points":[[0,0],[-0.37977430555557135,45.5013020833334]]},{"id":"w0WCHnxm","type":"text","x":-180.65060763888846,"y":-118.84114583333303,"width":42,"height":22,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"strokeSharpness":"sharp","seed":2088620076,"version":43,"versionNonce":2544404,"isDeleted":false,"boundElements":null,"updated":1671026825411,"link":null,"locked":false,"text":"复制","rawText":"复制","fontSize":20,"fontFamily":4,"textAlign":"left","verticalAlign":"top","baseline":18,"containerId":null,"originalText":"复制"},{"type":"text","version":130,"versionNonce":414357548,"isDeleted":false,"id":"gucnPqlo","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"angle":0,"x":81.9995659722226,"y":-115.69574652777743,"strokeColor":"#000000","backgroundColor":"transparent","width":42,"height":22,"seed":304932652,"groupIds":[],"strokeSharpness":"sharp","boundElements":[],"updated":1671026825411,"link":null,"locked":false,"fontSize":20,"fontFamily":4,"text":"复制","rawText":"复制","baseline":18,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"复制"}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#000000","currentItemBackgroundColor":"#15aabf","currentItemFillStyle":"hachure","currentItemStrokeWidth":1,"currentItemStrokeStyle":"dashed","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":4,"currentItemFontSize":20,"currentItemTextAlign":"left","currentItemStrokeSharpness":"sharp","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemLinearStrokeSharpness":"round","gridSize":null,"colorPalette":{}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("DDIA分享-04excalidraw.md4");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

比如redis的哨兵模式就是 **复制**， 集群模式就是 **分区** + **复制**

# 资料

- [Giahub上一份不错的开源翻译](https://github.com/Vonng/ddia)
- [木鸟杂记，个人觉得不错的一份笔记啊，缺点是后面几章没有](https://www.qtmuniao.com/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/DDIA/)
- [MIT 6.824 分布式系统](https://www.bilibili.com/video/BV1R7411t71W/)



